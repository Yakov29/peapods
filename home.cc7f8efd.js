var e=globalThis,t={},a={},n=e.parcelRequire2ef1;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in a){var n=a[e];delete a[e];var o={id:e,exports:{}};return t[e]=o,n.call(o.exports,o,o.exports),o.exports}var d=Error("Cannot find module '"+e+"'");throw d.code="MODULE_NOT_FOUND",d}).register=function(e,t){a[e]=t},e.parcelRequire2ef1=n),n.register;var o=n("fmRoT");async function d(){let e=JSON.parse(localStorage.getItem("loggedInUser"));if(e)try{let t=(await (0,o.default).get(`https://peapods-base.onrender.com/accounts/${e.id}`)).data;t?(document.getElementById("profileName").textContent=t.name,document.getElementById("profileNickname").textContent=`@${t.username}`):s()}catch(e){console.error("Error fetching profile:",e),s()}else window.location.href="index.html"}function s(){alert("Аккаунт удален или произошла ошибка."),localStorage.removeItem("loggedInUser"),window.location.href="index.html"}async function r(){try{let e=(await (0,o.default).get("https://peapods-base.onrender.com/pods")).data.sort((e,t)=>new Date(t.time)-new Date(e.time)),t=document.getElementById("podsContainer");t.innerHTML="";let a=JSON.parse(localStorage.getItem("loggedInUser")).id;e.forEach(e=>{let n=document.createElement("li");n.classList.add("pod"),n.innerHTML=`
                <div class="pod__title">
                    <img class="pod__user__image" src="${e.userImage||"./images/default-avatar.png"}" alt="User Image" style="cursor: pointer;" data-username="${e.username}">
                    <div class="pod__data">
                        <p class="pod__userdata" style="cursor: pointer;" data-username="${e.username}">${e.username||"Anonymous"}</p>
                        <p class="pod__time">${new Date(e.time).toLocaleString()}</p>
                    </div>
                </div>
                <h2 class="pod__text">${e.text}</h2>
                ${e.image?`<img class="pod__image" src="${e.image}" alt="Pod Image">`:""}
                <ul class="comments-list" id="comments-${e.id}">
                    ${e.comments?e.comments.map(t=>`
                        <li class="comment-item">
                            <p><b>${t.username}</b>: ${t.text}</p>
                            ${t.userId===a?`<button class="delete-comment-btn" data-comment-id="${t.commentId}" data-pod-id="${e.id}"><i class="fas fa-trash"></i></button>`:""}
                        </li>
                    `).join(""):""}
                </ul>
                <input class="comment-text" id="commentText-${e.id}" placeholder="Write a comment...">
                <button class="comment-btn" data-pod-id="${e.id}"><i class="fas fa-comment-dots"></i></button>
            `;let o=n.querySelector(".pod__user__image"),d=n.querySelector(".pod__userdata");if(o.addEventListener("click",()=>{e.username&&(window.location.href=`user.html?username=${encodeURIComponent(e.username)}`)}),d.addEventListener("click",()=>{e.username&&(window.location.href=`user.html?username=${encodeURIComponent(e.username)}`)}),e.userId===a){let t=document.createElement("button");t.innerHTML='<i class="fas fa-trash-alt"></i>',t.classList.add("delete-pod-button"),t.addEventListener("click",()=>{c(e.id)}),n.appendChild(t)}t.appendChild(n)}),function(){let e=document.querySelectorAll(".comment-btn"),t=document.querySelectorAll(".delete-comment-btn");e.forEach(e=>{e.addEventListener("click",async()=>{let t=e.getAttribute("data-pod-id"),a=document.getElementById(`commentText-${t}`).value;a.trim()&&await i(t,a)})}),t.forEach(e=>{e.addEventListener("click",async()=>{let t=e.getAttribute("data-pod-id"),a=e.getAttribute("data-comment-id");await m(t,a)})})}()}catch(e){console.error("Error fetching pods:",e)}}async function c(e){try{await (0,o.default).delete(`https://peapods-base.onrender.com/pods/${e}`),await l(e),r()}catch(e){console.error("Error deleting pod:",e)}}async function l(e){try{let t=(await (0,o.default).get("https://peapods-base.onrender.com/pods/"+e)).data,a=(await (0,o.default).get("https://peapods-base.onrender.com/accounts")).data.find(e=>e.username===t.username);a&&(a.podsCount=(a.podsCount||0)-1,await (0,o.default).put(`https://peapods-base.onrender.com/accounts/${a.id}`,a))}catch(e){console.error("Error updating profile pod count on delete:",e)}}async function i(e,t){try{let a=JSON.parse(localStorage.getItem("loggedInUser")),n=(await (0,o.default).get(`https://peapods-base.onrender.com/pods/${e}`)).data,d={commentId:Date.now(),userId:a.id,username:a.username,text:t};n.comments=n.comments||[],n.comments.push(d),await (0,o.default).put(`https://peapods-base.onrender.com/pods/${e}`,n),r()}catch(e){console.error("Error adding comment:",e)}}async function m(e,t){try{let a=(await (0,o.default).get(`https://peapods-base.onrender.com/pods/${e}`)).data;a.comments=a.comments.filter(e=>e.commentId!==parseInt(t)),await (0,o.default).put(`https://peapods-base.onrender.com/pods/${e}`,a),r()}catch(e){console.error("Error deleting comment:",e)}}const u=document.getElementById("createPodButton"),p=document.getElementById("createPodModal"),g=document.getElementById("closeModalButton"),f=document.getElementById("submitPodButton");async function h(e){try{await (0,o.default).post("https://peapods-base.onrender.com/pods",e)}catch(e){console.error("Error creating pod:",e)}}u.addEventListener("click",()=>{p.classList.toggle("change__invisible"),p.style.display="flex"}),g.addEventListener("click",()=>{p.classList.toggle("change__invisible"),setTimeout(()=>{p.style.display="none"},300)}),f.addEventListener("click",async()=>{let e=document.getElementById("podText").value,t=document.getElementById("podImageInput").files[0],a=document.getElementById("anonymousCheckbox").checked,n=JSON.parse(localStorage.getItem("loggedInUser")),o=document.querySelector(".home__avatar"),d=o?o.src:null,s={text:e,time:new Date().toISOString(),userImage:a?null:d,userId:a?null:n.id,username:a?null:n.username};if(t){let e=new FileReader;e.onload=async function(e){s.image=e.target.result,await h(s),document.getElementById("podText").value="",p.classList.toggle("change__invisible"),r()},e.readAsDataURL(t)}else await h(s),document.getElementById("podText").value="",r()}),document.addEventListener("DOMContentLoaded",async()=>{await d(),await r()});
//# sourceMappingURL=home.cc7f8efd.js.map
